<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HTML ËΩâ Markdown Â∑•ÂÖ∑</title>
    <script src="https://unpkg.com/turndown/dist/turndown.js"></script>
    <script src="https://unpkg.com/turndown-plugin-gfm/dist/turndown-plugin-gfm.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #fef9e7 0%, #fff3e0 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #f7b733 0%, #fc4a1a 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .main-content {
            padding: 40px;
        }

        .upload-section {
            margin-bottom: 30px;
        }

        .file-input-wrapper {
            position: relative;
            width: 100%;
        }

        .file-input {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
            z-index: 2;
        }

        .drop-zone {
            border: 3px dashed #f7b733;
            border-radius: 15px;
            padding: 60px 40px;
            text-align: center;
            background: #fffbf0;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            min-height: 200px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .drop-zone:hover,
        .drop-zone.drag-over {
            border-color: #fc4a1a;
            background: #fff3cd;
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(247, 183, 51, 0.2);
        }

        .drop-zone-icon {
            font-size: 4em;
            margin-bottom: 20px;
            color: #f7b733;
            transition: all 0.3s ease;
        }

        .drop-zone:hover .drop-zone-icon,
        .drop-zone.drag-over .drop-zone-icon {
            color: #fc4a1a;
            transform: scale(1.1);
        }

        .drop-zone-text {
            font-size: 1.2em;
            font-weight: 600;
            color: #856404;
            margin-bottom: 10px;
        }

        .drop-zone-subtext {
            font-size: 0.9em;
            color: #6c757d;
            margin-bottom: 20px;
        }

        .browse-button {
            background: linear-gradient(135deg, #f7b733 0%, #fc4a1a 100%);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px 24px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .browse-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(247, 183, 51, 0.4);
        }

        .drag-instructions {
            margin-top: 15px;
            color: #6c757d;
            font-size: 0.9em;
            text-align: center;
            font-style: italic;
        }

        .file-list {
            margin-top: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
        }

        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: white;
            margin-bottom: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .file-item:last-child {
            margin-bottom: 0;
        }

        .file-info {
            flex: 1;
        }

        .file-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .file-size {
            color: #666;
            font-size: 0.9em;
        }

        .file-status {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: 600;
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
        }

        .status-processing {
            background: #f7b733;
            color: white;
        }

        .status-completed {
            background: #ffc107;
            color: #212529;
        }

        .status-error {
            background: #fc4a1a;
            color: white;
        }

        .action-buttons {
            margin: 30px 0;
            text-align: center;
        }

        .btn {
            padding: 15px 30px;
            margin: 0 10px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, #f7b733 0%, #fc4a1a 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(247, 183, 51, 0.4);
        }

        .btn-secondary {
            background: #ddd;
            color: #333;
        }

        .btn-secondary:hover {
            background: #ccc;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .progress-section {
            margin: 30px 0;
            display: none;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #f7b733 0%, #fc4a1a 100%);
            width: 0%;
            transition: width 0.3s ease;
        }

        .progress-text {
            text-align: center;
            margin-top: 10px;
            font-weight: 600;
            color: #333;
        }

        .output-section {
            margin-top: 30px;
            display: none;
        }

        .output-item {
            margin-bottom: 20px;
            border: 1px solid #ddd;
            border-radius: 10px;
            overflow: hidden;
        }

        .output-header {
            background: #f8f9fa;
            padding: 15px;
            font-weight: 600;
            color: #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .output-content {
            padding: 0;
        }

        .output-textarea {
            width: 100%;
            min-height: 200px;
            border: none;
            padding: 20px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            resize: vertical;
            background: #fafafa;
            white-space: pre-wrap;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        .download-btn {
            padding: 8px 16px;
            background: #ffc107;
            color: #212529;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 600;
        }

        .download-btn:hover {
            background: #e0a800;
        }

        .download-all-section {
            margin-top: 20px;
            text-align: center;
        }

        .alert {
            padding: 15px;
            margin: 20px 0;
            border-radius: 8px;
            font-weight: 500;
        }

        .alert-info {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .alert-success {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        @media (max-width: 768px) {
            .main-content {
                padding: 20px;
            }

            .header h1 {
                font-size: 2em;
            }

            .btn {
                display: block;
                width: 100%;
                margin: 10px 0;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>üîÑ HTML ËΩâ Markdown</h1>
            <p>Â∞àÊ•≠ÁöÑÊâπÊ¨°ËΩâÊèõÂ∑•ÂÖ∑ÔºåÊîØÊè¥Â§öÊ™îÊ°àÂêåÊôÇËôïÁêÜ</p>
        </div>

        <div class="main-content"> <!-- Ê™îÊ°à‰∏äÂÇ≥ÂçÄÂüü -->
            <div class="upload-section">
                <div class="file-input-wrapper" id="dropZone">
                    <input type="file" id="fileInput" class="file-input" multiple accept=".html,.htm" />
                    <div class="drop-zone" id="dropZoneArea">
                        <div class="drop-zone-icon">üìÅ</div>
                        <div class="drop-zone-text">ÊãñÊõ≥ HTML Ê™îÊ°àÂà∞ÈÄôË£°</div>
                        <div class="drop-zone-subtext">ÊàñÈªûÊìä‰∏ãÊñπÊåâÈàïÈÅ∏ÊìáÊ™îÊ°à</div>
                        <button type="button" class="browse-button" id="browseButton">
                            ÁÄèË¶ΩÊ™îÊ°à
                        </button>
                    </div>
                </div>
                <div class="drag-instructions">
                    üí° ÊîØÊè¥Â§öÊ™îÊ°àÂêåÊôÇ‰∏äÂÇ≥ÔºåÂÉÖÊé•Âèó .html Âíå .htm Ê†ºÂºè
                </div>

                <div id="fileList" class="file-list" style="display: none;">
                    <h3>Â∑≤ÈÅ∏ÊìáÁöÑÊ™îÊ°àÔºö</h3>
                    <div id="fileItems"></div>
                </div>
            </div>

            <!-- Êìç‰ΩúÊåâÈàï -->
            <div class="action-buttons">
                <button id="convertBtn" class="btn btn-primary" disabled>
                    üöÄ ÈñãÂßãËΩâÊèõ
                </button>
                <button id="clearBtn" class="btn btn-secondary">
                    üóëÔ∏è Ê∏ÖÈô§ÊâÄÊúâ
                </button>
            </div>

            <!-- ÈÄ≤Â∫¶Ê¢ù -->
            <div id="progressSection" class="progress-section">
                <div class="progress-bar">
                    <div id="progressFill" class="progress-fill"></div>
                </div>
                <div id="progressText" class="progress-text">Ê∫ñÂÇô‰∏≠...</div>
            </div>

            <!-- ÁµêÊûúËº∏Âá∫ÂçÄÂüü -->
            <div id="outputSection" class="output-section">
                <h3>ËΩâÊèõÁµêÊûúÔºö</h3>
                <div id="outputItems"></div>

                <div class="download-all-section">
                    <button id="downloadAllBtn" class="btn btn-primary">
                        üíæ ‰∏ãËºâÊâÄÊúâ Markdown Ê™îÊ°à (ZIP)
                    </button>
                </div>
            </div>

            <!-- Ë™™ÊòéË≥áË®ä -->
            <div class="alert alert-info">
                <strong>‰ΩøÁî®Ë™™ÊòéÔºö</strong><br>
                1. Â∞á HTML Ê™îÊ°àÊãñÊõ≥Âà∞‰∏äÊñπËôõÁ∑öÊ°ÜÂÖßÔºåÊàñÈªûÊìä„ÄåÁÄèË¶ΩÊ™îÊ°à„ÄçÊåâÈàïÈÅ∏ÊìáÊ™îÊ°à<br>
                2. ÈªûÊìä„ÄåÈñãÂßãËΩâÊèõ„ÄçÊåâÈàïÈÄ≤Ë°åÊâπÊ¨°ËΩâÊèõ<br>
                3. ËΩâÊèõÂÆåÊàêÂæåÂèØ‰ª•È†êË¶ΩÁµêÊûúÊàñ‰∏ãËºâ Markdown Ê™îÊ°à<br>
                4. ÊîØÊè¥‰∏ãËºâÂñÆÂÄãÊ™îÊ°àÊàñÊâìÂåÖ‰∏ãËºâÊâÄÊúâÊ™îÊ°à
            </div>
        </div>
    </div>

    <!-- JSZip Â•ó‰ª∂Áî®ÊñºÊâìÂåÖ‰∏ãËºâ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

    <script>
        class Html2MdConverter {
            constructor() {
                this.files = [];
                this.results = [];
                this.turndownService = null;
                this.initTurndown();
                this.bindEvents();
            }

            initTurndown() {
                this.turndownService = new TurndownService({
                    headingStyle: 'atx',
                    hr: '---',
                    bulletListMarker: '-',
                    codeBlockStyle: 'fenced',
                    fence: '```',
                    emDelimiter: '_',
                    strongDelimiter: '**',
                    linkStyle: 'inlined',
                    linkReferenceStyle: 'full',
                    preformattedCode: true
                });

                // Âä†Ëºâ GitHub Flavored Markdown Êèí‰ª∂
                if (typeof turndownPluginGfm !== 'undefined') {
                    this.turndownService.use(turndownPluginGfm.gfm);
                }

                // Ëá™Ë®ÇË¶èÂâá
                this.turndownService.addRule('strikethrough', {
                    filter: ['del', 's', 'strike'],
                    replacement: function (content) {
                        return '~~' + content + '~~';
                    }
                });

                this.turndownService.addRule('highlight', {
                    filter: 'mark',
                    replacement: function (content) {
                        return '==' + content + '==';
                    }
                });

                // ËôïÁêÜÂúñÁâá
                this.turndownService.addRule('image', {
                    filter: 'img',
                    replacement: function (content, node) {
                        const alt = node.getAttribute('alt') || '';
                        const src = node.getAttribute('src') || '';
                        const title = node.getAttribute('title');
                        const titlePart = title ? ' "' + title + '"' : '';
                        return src ? '![' + alt + '](' + src + titlePart + ')' : '';
                    }
                });

                // ËôïÁêÜÊèõË°åÂíåÁ©∫ÁôΩÂ≠óÁ¨¶
                this.turndownService.addRule('preserveWhitespace', {
                    filter: function (node) {
                        return node.nodeName === 'BR';
                    },
                    replacement: function () {
                        return '\n\n';
                    }
                });
            }

            bindEvents() {
                const fileInput = document.getElementById('fileInput');
                const convertBtn = document.getElementById('convertBtn');
                const clearBtn = document.getElementById('clearBtn');
                const downloadAllBtn = document.getElementById('downloadAllBtn');
                const dropZone = document.getElementById('dropZone');
                const dropZoneArea = document.getElementById('dropZoneArea');
                const browseButton = document.getElementById('browseButton');

                fileInput.addEventListener('change', (e) => this.handleFileSelect(e));
                convertBtn.addEventListener('click', () => this.convertFiles());
                clearBtn.addEventListener('click', () => this.clearAll());
                downloadAllBtn.addEventListener('click', () => this.downloadAll());

                // ÊãñÊõ≥‰∏äÂÇ≥ÂäüËÉΩ
                dropZone.addEventListener('dragover', (e) => this.handleDragOver(e));
                dropZone.addEventListener('dragenter', (e) => this.handleDragEnter(e));
                dropZone.addEventListener('dragleave', (e) => this.handleDragLeave(e));
                dropZone.addEventListener('drop', (e) => this.handleDrop(e));

                // ÈªûÊìä‰∏äÂÇ≥
                browseButton.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    fileInput.click();
                });

                dropZoneArea.addEventListener('click', () => fileInput.click());
            }

            handleFileSelect(event) {
                const files = Array.from(event.target.files);
                this.processFiles(files);
            }

            handleDragOver(event) {
                event.preventDefault();
                event.stopPropagation();
            }

            handleDragEnter(event) {
                event.preventDefault();
                event.stopPropagation();
                const dropZoneArea = document.getElementById('dropZoneArea');
                dropZoneArea.classList.add('drag-over');
            }

            handleDragLeave(event) {
                event.preventDefault();
                event.stopPropagation();
                // Âè™ÊúâÁï∂Èõ¢ÈñãÊï¥ÂÄãÊãñÊõ≥ÂçÄÂüüÊôÇÊâçÁßªÈô§Ê®£Âºè
                if (!event.currentTarget.contains(event.relatedTarget)) {
                    const dropZoneArea = document.getElementById('dropZoneArea');
                    dropZoneArea.classList.remove('drag-over');
                }
            }

            handleDrop(event) {
                event.preventDefault();
                event.stopPropagation();

                const dropZoneArea = document.getElementById('dropZoneArea');
                dropZoneArea.classList.remove('drag-over');

                const files = Array.from(event.dataTransfer.files);
                this.processFiles(files);
            }

            processFiles(files) {
                this.files = files.filter(file =>
                    file.type === 'text/html' ||
                    file.name.toLowerCase().endsWith('.html') ||
                    file.name.toLowerCase().endsWith('.htm')
                );

                if (this.files.length === 0) {
                    this.showAlert('Ë´ãÈÅ∏ÊìáÊúâÊïàÁöÑ HTML Ê™îÊ°àÔºÅ', 'error');
                    return;
                }

                if (files.length > this.files.length) {
                    this.showAlert(`Â∑≤ÈÅéÊøæ ${files.length - this.files.length} ÂÄãÈùû HTML Ê™îÊ°àÔºåÂÉÖ‰øùÁïô ${this.files.length} ÂÄã HTML Ê™îÊ°à`, 'info');
                }

                this.displayFileList();
                document.getElementById('convertBtn').disabled = false;
            }

            displayFileList() {
                const fileList = document.getElementById('fileList');
                const fileItems = document.getElementById('fileItems');

                fileItems.innerHTML = '';

                this.files.forEach((file, index) => {
                    const fileItem = document.createElement('div');
                    fileItem.className = 'file-item';
                    fileItem.innerHTML = `
                        <div class="file-info">
                            <div class="file-name">${file.name}</div>
                            <div class="file-size">${this.formatFileSize(file.size)}</div>
                        </div>
                        <div class="file-status status-pending" id="status-${index}">ÂæÖËôïÁêÜ</div>
                    `;
                    fileItems.appendChild(fileItem);
                });

                fileList.style.display = 'block';
            }

            formatFileSize(bytes) {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            }

            async convertFiles() {
                const progressSection = document.getElementById('progressSection');
                const progressFill = document.getElementById('progressFill');
                const progressText = document.getElementById('progressText');
                const convertBtn = document.getElementById('convertBtn');

                progressSection.style.display = 'block';
                convertBtn.disabled = true;
                this.results = [];

                for (let i = 0; i < this.files.length; i++) {
                    const file = this.files[i];
                    const statusElement = document.getElementById(`status-${i}`);

                    try {
                        // Êõ¥Êñ∞ÁãÄÊÖã
                        statusElement.textContent = 'ËôïÁêÜ‰∏≠';
                        statusElement.className = 'file-status status-processing';

                        const progress = ((i + 1) / this.files.length) * 100;
                        progressFill.style.width = progress + '%';
                        progressText.textContent = `Ê≠£Âú®ËôïÁêÜ: ${file.name} (${i + 1}/${this.files.length})`;

                        // ËÆÄÂèñÊ™îÊ°àÂÖßÂÆπ
                        const htmlContent = await this.readFileContent(file);

                        // È©óË≠âÊ™îÊ°àÂÖßÂÆπÊòØÂê¶ÊúâÊïà
                        if (!this.isValidHtmlContent(htmlContent)) {
                            throw new Error('Ê™îÊ°àÂÖßÂÆπÊ†ºÂºè‰∏çÊ≠£Á¢∫ÊàñÁÇ∫Á©∫');
                        }

                        // Ê∏ÖÁêÜ HTML ÂÖßÂÆπÔºåÁßªÈô§ÂèØËÉΩÁöÑËÖ≥Êú¨ÂíåÊ®£Âºè
                        const cleanedHtml = this.cleanHtmlContent(htmlContent);

                        // ËΩâÊèõÁÇ∫ Markdown
                        let markdownContent = this.turndownService.turndown(cleanedHtml);

                        // Ê∏ÖÁêÜÂíåÊ†ºÂºèÂåñ Markdown ÂÖßÂÆπ
                        markdownContent = this.cleanMarkdown(markdownContent);

                        // ÂÜçÊ¨°È©óË≠âËΩâÊèõÁµêÊûú
                        if (markdownContent.length < 10) {
                            throw new Error('ËΩâÊèõÁµêÊûúÈÅéÁü≠ÔºåÂèØËÉΩËΩâÊèõÂ§±Êïó');
                        }

                        // ÂÑ≤Â≠òÁµêÊûú
                        this.results.push({
                            fileName: file.name.replace(/\.(html|htm)$/i, '.md'),
                            content: markdownContent,
                            originalName: file.name
                        });

                        // Êõ¥Êñ∞ÁãÄÊÖãÁÇ∫ÂÆåÊàê
                        statusElement.textContent = 'Â∑≤ÂÆåÊàê';
                        statusElement.className = 'file-status status-completed';

                    } catch (error) {
                        console.error('ËΩâÊèõÈåØË™§:', error);
                        statusElement.textContent = 'ÈåØË™§';
                        statusElement.className = 'file-status status-error';

                        this.results.push({
                            fileName: file.name,
                            content: `ËΩâÊèõÈåØË™§: ${error.message}`,
                            originalName: file.name,
                            error: true
                        });
                    }

                    // Ê∑ªÂä†Â∞èÂª∂ÈÅ≤‰ª•ÈÅøÂÖçÁÄèË¶ΩÂô®ÈòªÂ°û
                    await new Promise(resolve => setTimeout(resolve, 50));
                }

                progressText.textContent = 'ËΩâÊèõÂÆåÊàêÔºÅ';
                this.displayResults();
                convertBtn.disabled = false;
            }

            readFileContent(file) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = (e) => resolve(e.target.result);
                    reader.onerror = (e) => reject(new Error('Ê™îÊ°àËÆÄÂèñÂ§±Êïó'));
                    reader.readAsText(file, 'UTF-8');
                });
            }

            cleanMarkdown(markdown) {
                // ÁßªÈô§Â§öÈ§òÁöÑÁ©∫Ë°åÔºàË∂ÖÈÅé2ÂÄãÈÄ£Á∫åÊèõË°åÔºâ
                markdown = markdown.replace(/\n{3,}/g, '\n\n');

                // Á¢∫‰øùÊ®ôÈ°åÂâçÂæåÊúâÈÅ©Áï∂ÁöÑÁ©∫Ë°å
                markdown = markdown.replace(/([^\n])\n(#{1,6}\s)/g, '$1\n\n$2');
                markdown = markdown.replace(/(#{1,6}[^\n]+)\n([^\n#])/g, '$1\n\n$2');

                // Á¢∫‰øùÊ∏ÖÂñÆÈ†ÖÁõÆÊ†ºÂºèÊ≠£Á¢∫
                markdown = markdown.replace(/\n([*\-+]|\d+\.)\s/g, '\n$1 ');

                // ÁßªÈô§Ë°åÈ¶ñÂíåË°åÂ∞æÁöÑÁ©∫ÁôΩÂ≠óÁ¨¶
                markdown = markdown.split('\n').map(line => line.trim()).join('\n');

                // ÁßªÈô§ÈñãÈ†≠ÂíåÁµêÂ∞æÁöÑÁ©∫Ë°å
                markdown = markdown.replace(/^\n+/, '').replace(/\n+$/, '');

                return markdown;
            }

            isValidHtmlContent(content) {
                // Ê™¢Êü•ÊòØÂê¶ÁÇ∫Á©∫ÊàñÈÅéÁü≠
                if (!content || content.trim().length < 10) {
                    return false;
                }

                // Ê™¢Êü•ÊòØÂê¶ÂåÖÂê´Âü∫Êú¨ÁöÑ HTML ÁµêÊßã
                const hasHtmlTags = /<[^>]+>/g.test(content);
                if (!hasHtmlTags) {
                    return false;
                }

                return true;
            }

            cleanHtmlContent(html) {
                try {
                    // ÂÖàÁî®Ê≠£ÂâáË°®ÈÅîÂºèÈÄ≤Ë°åÂü∫Êú¨Ê∏ÖÁêÜÔºåÈÅøÂÖçËß£ÊûêÂô®ÂïèÈ°å
                    let preCleanedHtml = html
                        .replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi, '')
                        .replace(/<style\b[^<]*(?:(?!<\/style>)<[^<]*)*<\/style>/gi, '')
                        .replace(/<link\b[^>]*>/gi, '')
                        .replace(/<meta\b[^>]*>/gi, '')
                        .replace(/<!--[\s\S]*?-->/gi, '');

                    // ÂâµÂª∫‰∏ÄÂÄãËá®ÊôÇÁöÑ DOM Ëß£ÊûêÂô®
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(preCleanedHtml, 'text/html');

                    // Ê™¢Êü•Ëß£ÊûêÊòØÂê¶ÊàêÂäü
                    if (!doc || !doc.documentElement) {
                        throw new Error('HTML Ëß£ÊûêÂ§±Êïó');
                    }

                    // ÂÜçÊ¨°ÁßªÈô§ÂèØËÉΩÊÆòÁïôÁöÑÊ®ôÁ±§
                    try {
                        const scripts = doc.querySelectorAll('script');
                        scripts.forEach(script => {
                            try { script.remove(); } catch (e) { console.warn('ÁßªÈô§scriptÈåØË™§:', e); }
                        });

                        const styles = doc.querySelectorAll('style');
                        styles.forEach(style => {
                            try { style.remove(); } catch (e) { console.warn('ÁßªÈô§styleÈåØË™§:', e); }
                        });

                        const links = doc.querySelectorAll('link');
                        links.forEach(link => {
                            try { link.remove(); } catch (e) { console.warn('ÁßªÈô§linkÈåØË™§:', e); }
                        });

                        const metas = doc.querySelectorAll('meta');
                        metas.forEach(meta => {
                            try { meta.remove(); } catch (e) { console.warn('ÁßªÈô§metaÈåØË™§:', e); }
                        });
                    } catch (error) {
                        console.warn('ÁßªÈô§Ê®ôÁ±§ÊôÇÁôºÁîüÈåØË™§:', error);
                    }

                    // ÁßªÈô§Ë®ªÈáãÁöÑÂÆâÂÖ®ÊñπÊ≥ï
                    try {
                        this.removeComments(doc);
                    } catch (error) {
                        console.warn('ÁßªÈô§Ë®ªÈáãÂ§±ÊïóÔºåÁπºÁ∫åËôïÁêÜ:', error);
                    }

                    // ÂòóË©¶ÊèêÂèñ body ÂÖßÂÆπÔºåÂ¶ÇÊûúÊ≤íÊúâ body Ââá‰ΩøÁî®Êï¥ÂÄãÊñáÊ™î
                    const body = doc.body;
                    if (body && body.innerHTML.trim()) {
                        return body.innerHTML;
                    } else {
                        // Â¶ÇÊûúÊ≤íÊúâ bodyÔºåÊèêÂèñÊâÄÊúâÊñáÊú¨ÂÖßÂÆπÁõ∏ÈóúÁöÑÊ®ôÁ±§
                        const contentElements = doc.querySelectorAll('h1, h2, h3, h4, h5, h6, p, div, span, a, img, ul, ol, li, table, tr, td, th, blockquote, pre, code, article, section, main');
                        if (contentElements.length > 0) {
                            let cleanedContent = '';
                            contentElements.forEach(el => {
                                try {
                                    cleanedContent += el.outerHTML + '\n';
                                } catch (e) {
                                    console.warn('ÊèêÂèñÂÖÉÁ¥†ÂÖßÂÆπÈåØË™§:', e);
                                }
                            });
                            return cleanedContent;
                        } else {
                            // ÊúÄÂæåÁöÑÂÇôÈÅ∏ÊñπÊ°àÔºöËøîÂõûÈ†êÊ∏ÖÁêÜÁöÑÂÖßÂÆπ
                            return preCleanedHtml;
                        }
                    }
                } catch (error) {
                    console.warn('HTML Ê∏ÖÁêÜÈÅéÁ®ã‰∏≠ÁôºÁîüÈåØË™§Ôºå‰ΩøÁî®ÂÇôÈÅ∏ÊñπÊ°à:', error);
                    // Â¶ÇÊûúËß£ÊûêÂ§±ÊïóÔºå‰ΩøÁî®Ê≠£ÂâáË°®ÈÅîÂºèÊ∏ÖÁêÜ
                    return html.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi, '')
                        .replace(/<style\b[^<]*(?:(?!<\/style>)<[^<]*)*<\/style>/gi, '')
                        .replace(/<link\b[^>]*>/gi, '')
                        .replace(/<meta\b[^>]*>/gi, '')
                        .replace(/<!--[\s\S]*?-->/gi, '');
                }
            }

            removeComments(element) {
                try {
                    // ‰ΩøÁî®ÈÅûÊ≠∏ÊñπÂºèÂÆâÂÖ®ÁßªÈô§Ë®ªÈáã
                    this.removeCommentsRecursively(element);
                } catch (error) {
                    console.warn('ÁßªÈô§Ë®ªÈáãÊôÇÁôºÁîüÈåØË™§:', error);
                    // Â¶ÇÊûúÂá∫ÈåØÔºåÂøΩÁï•Ë®ªÈáãÁßªÈô§Ê≠•È©ü
                }
            }

            removeCommentsRecursively(node) {
                // Êî∂ÈõÜË¶ÅÁßªÈô§ÁöÑË®ªÈáãÁØÄÈªû
                const commentsToRemove = [];

                // ÈÅçÊ≠∑ÊâÄÊúâÂ≠êÁØÄÈªû
                for (let i = 0; i < node.childNodes.length; i++) {
                    const child = node.childNodes[i];

                    if (child.nodeType === Node.COMMENT_NODE) {
                        commentsToRemove.push(child);
                    } else if (child.nodeType === Node.ELEMENT_NODE) {
                        // ÈÅûÊ≠∏ËôïÁêÜÂ≠êÂÖÉÁ¥†
                        this.removeCommentsRecursively(child);
                    }
                }

                // ÁßªÈô§Êî∂ÈõÜÂà∞ÁöÑË®ªÈáã
                commentsToRemove.forEach(comment => {
                    try {
                        if (comment.parentNode) {
                            comment.parentNode.removeChild(comment);
                        }
                    } catch (e) {
                        console.warn('ÁßªÈô§ÂñÆÂÄãË®ªÈáãÊôÇÁôºÁîüÈåØË™§:', e);
                    }
                });
            }

            displayResults() {
                const outputSection = document.getElementById('outputSection');
                const outputItems = document.getElementById('outputItems');

                outputItems.innerHTML = '';

                this.results.forEach((result, index) => {
                    const outputItem = document.createElement('div');
                    outputItem.className = 'output-item';

                    const downloadBtn = result.error ? '' : `
                        <button class="download-btn" onclick="converter.downloadSingle(${index})">
                            üíæ ‰∏ãËºâ
                        </button>
                    `;

                    outputItem.innerHTML = `
                        <div class="output-header">
                            <span>${result.fileName}</span>
                            ${downloadBtn}
                        </div>
                        <div class="output-content">
                            <textarea class="output-textarea" readonly>${result.content}</textarea>
                        </div>
                    `;

                    outputItems.appendChild(outputItem);
                });

                outputSection.style.display = 'block';
                this.showAlert(`ÊàêÂäüËΩâÊèõ ${this.results.filter(r => !r.error).length} ÂÄãÊ™îÊ°àÔºÅ`, 'success');
            }

            downloadSingle(index) {
                const result = this.results[index];
                if (result.error) return;

                const blob = new Blob([result.content], { type: 'text/markdown;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = result.fileName;
                a.click();
                URL.revokeObjectURL(url);
            }

            async downloadAll() {
                if (this.results.length === 0) {
                    this.showAlert('Ê≤íÊúâÂèØ‰∏ãËºâÁöÑÊ™îÊ°àÔºÅ', 'error');
                    return;
                }

                const zip = new JSZip();
                const validResults = this.results.filter(r => !r.error);

                validResults.forEach(result => {
                    zip.file(result.fileName, result.content);
                });

                try {
                    const content = await zip.generateAsync({ type: 'blob' });
                    const url = URL.createObjectURL(content);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'converted-markdown-files.zip';
                    a.click();
                    URL.revokeObjectURL(url);

                    this.showAlert('ZIP Ê™îÊ°àÂ∑≤‰∏ãËºâÔºÅ', 'success');
                } catch (error) {
                    this.showAlert('‰∏ãËºâÂ§±ÊïóÔºö' + error.message, 'error');
                }
            }

            clearAll() {
                this.files = [];
                this.results = [];

                document.getElementById('fileInput').value = '';
                document.getElementById('fileList').style.display = 'none';
                document.getElementById('progressSection').style.display = 'none';
                document.getElementById('outputSection').style.display = 'none';
                document.getElementById('convertBtn').disabled = true;

                // Ê∏ÖÈô§‰ªª‰ΩïÈ°ØÁ§∫ÁöÑË≠¶Âëä
                const alerts = document.querySelectorAll('.alert:not(.alert-info)');
                alerts.forEach(alert => alert.remove());
            }

            showAlert(message, type = 'info') {
                // ÁßªÈô§ËàäÁöÑË≠¶Âëä
                const oldAlerts = document.querySelectorAll('.alert:not(.alert-info)');
                oldAlerts.forEach(alert => alert.remove());

                const alert = document.createElement('div');
                alert.className = `alert alert-${type}`;
                alert.innerHTML = message;

                const mainContent = document.querySelector('.main-content');
                const infoAlert = document.querySelector('.alert-info');
                mainContent.insertBefore(alert, infoAlert);

                // 3ÁßíÂæåËá™ÂãïÊ∂àÂ§±
                setTimeout(() => {
                    if (alert.parentNode) {
                        alert.remove();
                    }
                }, 3000);
            }
        }

        // ÂàùÂßãÂåñËΩâÊèõÂô®
        const converter = new Html2MdConverter();
    </script>
</body>

</html>